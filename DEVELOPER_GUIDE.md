# Developer Guide

## Overview

Arrranger is a tool for synchronizing media library information between Radarr and Sonarr. It supports both manual and automatic operations with advanced filtering and scheduling capabilities.

## Features

### Manual Operations
- Backup Radarr and Sonarr instances manually.
- Sync between compatible instances.
- Restore backups from database.

### Automatic Operations
- Scheduled backups (daily, weekly, monthly, or custom cron).
- Automatic sync for parent-child instance relationships.
- Filtering based on quality profiles, download folders, and tags.

## Setup and Installation

### Prerequisites
- Python 3.11 or later.
- Docker and Docker Compose.
- Required Python packages as listed in `requirements.txt`.

### Installation
1. Clone the repository:
   ```
   git clone https://github.com/lucanori/arrranger.git
   cd arrranger
   ```
2. Install dependencies:
   ```
   pip install -r requirements.txt
   ```
3. Set up the configuration:
   ```
   mkdir -p config
   cp arrranger_instances.json.example config/arrranger_instances.json
   ```
   Edit `config/arrranger_instances.json` to configure your instances.

### Docker Setup
- Build the Docker image:
   ```
   docker build -t arrranger .
   ```
- Run via Docker Compose:
   ```
   docker-compose up -d
   ```
- For local development:
   ```
   # Ensure data directory with database exists and has proper permissions
   mkdir -p data
   touch data/arrranger.db
   chmod 777 data data/arrranger.db
   
   # Run with local configuration
   docker compose -f docker-compose.local.yml up -d
   ```

## Code Structure
- `arrranger_sync.py` – Provides an interactive menu for manual operations such as backup, sync, restore, and viewing configured instances.
- `arrranger_scheduler.py` – Manages scheduled tasks including automatic backups and sync operations with precise timing.
- `arrranger_instances.json.example` – Example configuration file for setting up Radarr/Sonarr instances.
- `Dockerfile` and `docker-compose.yml` – Define the containerized environment.
- `docker-compose.local.yml` - Defines a local development environment with mounted volumes.
- `config/` – Directory for configuration files.
- `data/` – Stores data used or generated by the application, including the SQLite database.
- `TROUBLESHOOTING.md` - Contains solutions for common issues, especially Docker-related problems.

## Environment Variables

The application uses the following environment variables:

- `CONFIG_FILE` - Path to the configuration file (default: `arrranger_instances.json` in the current directory)
- `DB_NAME` - Path to the SQLite database file (default: `arrranger.db` in the current directory)
- `CONFIG_DIR` - Directory containing configuration files (used in Docker, default: `/config`)
- `DATA_DIR` - Directory for storing data (used in Docker, default: `/data`)

## Usage

### Running the Application
- For manual operations, run:
   ```
   python arrranger_sync.py
   ```
- For scheduled tasks, run:
   ```
   python arrranger_scheduler.py
   ```

## Development

### Contribution Guidelines
- Follow PEP8 coding standards.
- Add tests as necessary.
- Document new features and update this guide accordingly.
- Use Git for version control and create pull requests for code reviews.

### Common Issues and Troubleshooting
- Check Docker logs if containers fail to start: `docker logs arrranger-local`
- Verify the configuration in `config/arrranger_instances.json`, ensuring proper JSON format with commas between elements.
- Ensure all dependencies are installed correctly.
- If encountering database connection issues, refer to the detailed solutions in `TROUBLESHOOTING.md`.

## Additional Resources
- Refer to `README.md` for detailed usage instructions.
- Consult the official documentation for Python, Docker, and Docker Compose.
- Review the `LICENSE` file for licensing details.

Happy developing!